zabbix_export:
  version: '7.2'
  template_groups:
    - uuid: 25a9b0f2d6aa4f7d9e62f5d29c98342f
      name: Templates/Applications
  templates:
    - uuid: 5c6f3c6e24314452bbd89d75b2c5b772
      template: 'Apache Airflow by HTTP'
      name: 'Apache Airflow by HTTP'
      description: |
        Template for monitoring Apache Airflow via /api/v2/monitor/health. Uses HTTP agent, dependent items, and triggers for component statuses.
        https://github.com/foksk76/airflow_template
      vendor:
        name: foksk76
        version: 7.2-0
      groups:
        - name: Templates/Applications
      items:
        - uuid: 2f4f6409b7bb49fdb57cf70e2611a764
          name: 'Airflow DAG processor status'
          type: DEPENDENT
          key: airflow.dag_processor.status
          value_type: CHAR
          description: 'Status of Airflow DAG processor component'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.dag_processor.status
          master_item:
            key: airflow.health.raw
          tags:
            - tag: component
              value: health
          triggers:
            - uuid: c2e4f7b1a9d448c0a4e3b5d8f2a7e6c4
              expression: 'last(/Apache Airflow by HTTP/airflow.dag_processor.status,#1)<>"healthy" and last(/Apache Airflow by HTTP/airflow.dag_processor.status,#2)<>"healthy"'
              name: 'Airflow DAG processor unhealthy'
              priority: AVERAGE
              description: 'DAG processor component is not healthy.'
        - uuid: 94b3e3b12ac14e6da58e9f0e2e97a7e4
          name: 'Airflow health (raw)'
          type: HTTP_AGENT
          key: airflow.health.raw
          delay: 5m
          history: 1d
          value_type: TEXT
          description: 'Fetch full JSON response from Airflow /api/v2/monitor/health'
          timeout: 10s
          url: '{$AIRFLOW.URL}/api/v2/monitor/health'
          tags:
            - tag: component
              value: raw
          triggers:
            - uuid: 09eb010a5f5f4fa4b9f7b2ec07c35e82
              expression: 'nodata(/Apache Airflow by HTTP/airflow.health.raw,10m)=1'
              name: 'Airflow API not reachable'
              priority: HIGH
              description: 'Airflow API did not respond in the last 2 minutes.'
        - uuid: 6cf6f76fd3874f8d8f57a3b2cc1c5e0c
          name: 'Airflow metadatabase status'
          type: DEPENDENT
          key: airflow.metadatabase.status
          value_type: CHAR
          description: 'Status of Airflow metadatabase component'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.metadatabase.status
          master_item:
            key: airflow.health.raw
          tags:
            - tag: component
              value: health
          triggers:
            - uuid: 0d5629d579f54aff9ea0484ec9276aa4
              expression: 'last(/Apache Airflow by HTTP/airflow.metadatabase.status,#1)<>"healthy" and last(/Apache Airflow by HTTP/airflow.metadatabase.status,#2)<>"healthy"'
              name: 'Airflow metadatabase unhealthy'
              priority: AVERAGE
              description: 'Metadatabase component is not healthy.'
        - uuid: a8f9152338304f788b66cf3ec5c60292
          name: 'Airflow scheduler status'
          type: DEPENDENT
          key: airflow.scheduler.status
          value_type: CHAR
          description: 'Status of Airflow scheduler component'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.scheduler.status
          master_item:
            key: airflow.health.raw
          tags:
            - tag: component
              value: health
          triggers:
            - uuid: b1f3123d4c5e4e839a9f2e1d33b97d1f
              expression: 'last(/Apache Airflow by HTTP/airflow.scheduler.status,#1)<>"healthy" and last(/Apache Airflow by HTTP/airflow.scheduler.status,#2)<>"healthy"'
              name: 'Airflow scheduler unhealthy'
              priority: AVERAGE
              description: 'Scheduler component is not healthy â€” DAG execution may fail.'
        - uuid: 92f22b5c709d4cfdab7d5a84f1df2d15
          name: 'Airflow triggerer status'
          type: DEPENDENT
          key: airflow.triggerer.status
          value_type: CHAR
          description: 'Status of Airflow triggerer component'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.triggerer.status
          master_item:
            key: airflow.health.raw
          tags:
            - tag: component
              value: health
          triggers:
            - uuid: 8f4e7a3b2d5c4e9fbe1d7a6c3b2a8d9e
              expression: 'last(/Apache Airflow by HTTP/airflow.triggerer.status,#1)<>"healthy" and last(/Apache Airflow by HTTP/airflow.triggerer.status,#2)<>"healthy"'
              name: 'Airflow triggerer unhealthy'
              priority: AVERAGE
              description: 'Triggerer component is not healthy.'
      tags:
        - tag: class
          value: software
        - tag: subclass
          value: workflow
        - tag: target
          value: airflow
      macros:
        - macro: '{$AIRFLOW.URL}'
          value: 'http://localhost:8080'
          description: 'Base URL for Airflow API endpoint'
